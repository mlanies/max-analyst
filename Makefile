# MAX Analyst - Security Monitoring System
# Makefile –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–º –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∑–∞–¥–∞—á

.PHONY: help install setup clean analyze monitor report test lint docs start stop restart web api status health info backup restore update quick traffic emulator studio realistic

# =============================================================================
# –ü–ï–†–ï–ú–ï–ù–ù–´–ï
# =============================================================================

PROJECT_NAME = MAX Analyst
VERSION = 2.0.0
ANALYSIS_DIR = analysis
SCRIPTS_DIR = $(ANALYSIS_DIR)/scripts
REPORTS_DIR = $(ANALYSIS_DIR)/reports
LOG_DIR = $(ANALYSIS_DIR)/logs
WEB_DIR = $(ANALYSIS_DIR)/web
API_DIR = $(ANALYSIS_DIR)/backend/api

# –ü–æ—Ä—Ç—ã
WEB_PORT = 8000
API_PORT = 5003

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED = \033[0;31m
GREEN = \033[0;32m
YELLOW = \033[1;33m
BLUE = \033[0;34m
NC = \033[0m # No Color

# =============================================================================
# –û–°–ù–û–í–ù–´–ï –ö–û–ú–ê–ù–î–´
# =============================================================================

# –ü–æ–º–æ—â—å
help:
	@echo "$(BLUE)$(PROJECT_NAME) v$(VERSION)$(NC)"
	@echo ""
	@echo "$(YELLOW)–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:$(NC)"
	@echo "  $(GREEN)start$(NC)       - –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å—é —Å–∏—Å—Ç–µ–º—É (–≤–µ–± + API)"
	@echo "  $(GREEN)web$(NC)         - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å"
	@echo "  $(GREEN)api$(NC)         - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ API —Å–µ—Ä–≤–µ—Ä"
	@echo "  $(GREEN)stop$(NC)        - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã"
	@echo "  $(GREEN)restart$(NC)     - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã"
	@echo "  $(GREEN)status$(NC)      - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã"
	@echo ""
	@echo "$(YELLOW)–ê–Ω–∞–ª–∏–∑ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:$(NC)"
	@echo "  $(GREEN)analyze$(NC)     - –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞"
	@echo "  $(GREEN)monitor$(NC)     - –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞"
	@echo "  $(GREEN)realistic$(NC)   - –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"
	@echo "  $(GREEN)quick$(NC)       - –ë—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑"
	@echo "  $(GREEN)traffic$(NC)     - –ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞—Ñ–∏–∫–∞"
	@echo ""
	@echo "$(YELLOW)–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–º:$(NC)"
	@echo "  $(GREEN)install$(NC)     - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"
	@echo "  $(GREEN)setup$(NC)       - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è"
	@echo "  $(GREEN)report$(NC)      - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤"
	@echo "  $(GREEN)clean$(NC)       - –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤"
	@echo "  $(GREEN)backup$(NC)      - –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞"
	@echo "  $(GREEN)update$(NC)      - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞"
	@echo ""
	@echo "$(YELLOW)Android –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:$(NC)"
	@echo "  $(GREEN)emulator$(NC)    - –ó–∞–ø—É—Å–∫ Android —ç–º—É–ª—è—Ç–æ—Ä–∞"
	@echo "  $(GREEN)studio$(NC)      - –ó–∞–ø—É—Å–∫ Android Studio"
	@echo ""
	@echo "$(YELLOW)–£—Ç–∏–ª–∏—Ç—ã:$(NC)"
	@echo "  $(GREEN)test$(NC)        - –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤"
	@echo "  $(GREEN)lint$(NC)        - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞"
	@echo "  $(GREEN)docs$(NC)        - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏"
	@echo "  $(GREEN)health$(NC)      - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã"
	@echo "  $(GREEN)info$(NC)        - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ"
	@echo "  $(GREEN)help$(NC)        - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É"

# =============================================================================
# –ó–ê–ü–£–°–ö –°–ò–°–¢–ï–ú–´
# =============================================================================

# –ó–∞–ø—É—Å–∫ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã
start: web api
	@echo "$(GREEN)‚úÖ $(PROJECT_NAME) –∑–∞–ø—É—â–µ–Ω!$(NC)"
	@echo "$(BLUE)üåê –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: http://localhost:$(WEB_PORT)$(NC)"
	@echo "$(BLUE)üîå API: http://localhost:$(API_PORT)$(NC)"
	@echo "$(YELLOW)–î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: make stop$(NC)"

# –ó–∞–ø—É—Å–∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
web:
	@echo "$(BLUE)–ó–∞–ø—É—Å–∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –Ω–∞ –ø–æ—Ä—Ç—É $(WEB_PORT)...$(NC)"
	@cd $(WEB_DIR) && python3 -m http.server $(WEB_PORT) > ../logs/web_server.log 2>&1 &
	@echo "$(GREEN)‚úÖ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ—Å—Ç—É–ø–µ–Ω: http://localhost:$(WEB_PORT)$(NC)"

# –ó–∞–ø—É—Å–∫ API —Å–µ—Ä–≤–µ—Ä–∞
api:
	@echo "$(BLUE)–ó–∞–ø—É—Å–∫ API —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –ø–æ—Ä—Ç—É $(API_PORT)...$(NC)"
	@cd $(API_DIR) && source ../../venv/bin/activate && python simple_api.py > ../../logs/api_server.log 2>&1 &
	@echo "$(GREEN)‚úÖ API –¥–æ—Å—Ç—É–ø–µ–Ω: http://localhost:$(API_PORT)$(NC)"

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
stop:
	@echo "$(BLUE)–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤...$(NC)"
	@pkill -f "python3 -m http.server $(WEB_PORT)" >/dev/null 2>&1 || true
	@pkill -f "simple_api.py" >/dev/null 2>&1 || true
	@pkill -f "api_server.py" >/dev/null 2>&1 || true
	@echo "$(GREEN)‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã$(NC)"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã
restart: stop start

# =============================================================================
# –£–°–¢–ê–ù–û–í–ö–ê –ò –ù–ê–°–¢–†–û–ô–ö–ê
# =============================================================================

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
install:
	@echo "$(BLUE)–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...$(NC)"
	@which adb >/dev/null 2>&1 || (echo "$(RED)‚ùå ADB –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Android SDK$(NC)" && exit 1)
	@which python3 >/dev/null 2>&1 || (echo "$(RED)‚ùå Python3 –Ω–µ –Ω–∞–π–¥–µ–Ω$(NC)" && exit 1)
	@which make >/dev/null 2>&1 || (echo "$(RED)‚ùå Make –Ω–µ –Ω–∞–π–¥–µ–Ω$(NC)" && exit 1)
	@echo "$(GREEN)‚úÖ –°–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã$(NC)"
	@echo "$(BLUE)–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è...$(NC)"
	@cd $(ANALYSIS_DIR) && python3 -m venv venv
	@cd $(ANALYSIS_DIR) && source venv/bin/activate && pip install flask flask-cors requests
	@echo "$(GREEN)‚úÖ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã$(NC)"

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
setup:
	@echo "$(BLUE)–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è...$(NC)"
	@mkdir -p $(LOG_DIR) $(REPORTS_DIR) $(ANALYSIS_DIR)/temp $(WEB_DIR) $(API_DIR)
	@chmod +x $(ANALYSIS_DIR)/*.sh 2>/dev/null || true
	@chmod +x $(SCRIPTS_DIR)/*.sh 2>/dev/null || true
	@echo "$(GREEN)‚úÖ –û–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ$(NC)"

# =============================================================================
# –ê–ù–ê–õ–ò–ó –ò –ú–û–ù–ò–¢–û–†–ò–ù–ì
# =============================================================================

# –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
analyze:
	@echo "$(BLUE)–ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞...$(NC)"
	@cd $(ANALYSIS_DIR) && ./start.sh

# –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
monitor:
	@echo "$(BLUE)–ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞...$(NC)"
	@cd $(ANALYSIS_DIR) && ./scripts/bash/live_monitoring.sh

# –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
realistic:
	@echo "$(BLUE)–ó–∞–ø—É—Å–∫ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏...$(NC)"
	@cd $(ANALYSIS_DIR) && ./scripts/bash/realistic_analysis.sh

# –ë—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑
quick:
	@echo "$(BLUE)–ë—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑...$(NC)"
	@cd $(ANALYSIS_DIR) && ./scripts/bash/simple_traffic_analysis.sh

# –ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞—Ñ–∏–∫–∞
traffic:
	@echo "$(BLUE)–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞—Ñ–∏–∫–∞...$(NC)"
	@cd $(ANALYSIS_DIR) && ./scripts/bash/traffic_analysis.sh

# =============================================================================
# –û–¢–ß–ï–¢–´ –ò –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø
# =============================================================================

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤
report:
	@echo "$(BLUE)–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤...$(NC)"
	@cd $(SCRIPTS_DIR) && ./report_generator.sh all
	@echo "$(GREEN)‚úÖ –û—Ç—á–µ—Ç—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ $(REPORTS_DIR)$(NC)"

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
docs:
	@echo "$(BLUE)–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏...$(NC)"
	@echo "$(YELLOW)‚ö†Ô∏è  –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞$(NC)"

# =============================================================================
# –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ò –ü–†–û–í–ï–†–ö–ê
# =============================================================================

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
test:
	@echo "$(BLUE)–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤...$(NC)"
	@echo "$(YELLOW)‚ö†Ô∏è  –¢–µ—Å—Ç—ã –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã$(NC)"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
lint:
	@echo "$(BLUE)–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞...$(NC)"
	@which shellcheck >/dev/null 2>&1 && find $(ANALYSIS_DIR) -name "*.sh" -exec shellcheck {} \; || echo "$(YELLOW)‚ö†Ô∏è  ShellCheck –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω$(NC)"
	@echo "$(GREEN)‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞$(NC)"

# =============================================================================
# –°–¢–ê–¢–£–° –ò –ò–ù–§–û–†–ú–ê–¶–ò–Ø
# =============================================================================

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
status:
	@echo "$(BLUE)–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:$(NC)"
	@echo "  –í–µ—Ä—Å–∏—è: $(VERSION)"
	@echo "  –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:"
	@echo "    –ê–Ω–∞–ª–∏–∑: $(ANALYSIS_DIR)"
	@echo "    –°–∫—Ä–∏–ø—Ç—ã: $(SCRIPTS_DIR)"
	@echo "    –û—Ç—á–µ—Ç—ã: $(REPORTS_DIR)"
	@echo "    –õ–æ–≥–∏: $(LOG_DIR)"
	@echo "    –í–µ–±: $(WEB_DIR)"
	@echo "    API: $(API_DIR)"
	@echo "  –°–µ—Ä–≤–∏—Å—ã:"
	@ps aux | grep -E "(http.server|simple_api)" | grep -v grep || echo "    –ù–µ—Ç –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã
health:
	@echo "$(BLUE)–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã...$(NC)"
	@echo "  –ü—Ä–æ–≤–µ—Ä–∫–∞ ADB..."
	@adb version >/dev/null 2>&1 && echo "$(GREEN)‚úÖ ADB —Ä–∞–±–æ—Ç–∞–µ—Ç$(NC)" || echo "$(RED)‚ùå ADB –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç$(NC)"
	@echo "  –ü—Ä–æ–≤–µ—Ä–∫–∞ Python..."
	@python3 --version >/dev/null 2>&1 && echo "$(GREEN)‚úÖ Python —Ä–∞–±–æ—Ç–∞–µ—Ç$(NC)" || echo "$(RED)‚ùå Python –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç$(NC)"
	@echo "  –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π..."
	@[ -d "$(ANALYSIS_DIR)" ] && echo "$(GREEN)‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∞–Ω–∞–ª–∏–∑–∞$(NC)" || echo "$(RED)‚ùå –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∞–Ω–∞–ª–∏–∑–∞$(NC)"
	@[ -d "$(SCRIPTS_DIR)" ] && echo "$(GREEN)‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤$(NC)" || echo "$(RED)‚ùå –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤$(NC)"
	@[ -d "$(WEB_DIR)" ] && echo "$(GREEN)‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –≤–µ–±$(NC)" || echo "$(RED)‚ùå –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –≤–µ–±$(NC)"
	@[ -d "$(API_DIR)" ] && echo "$(GREEN)‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è API$(NC)" || echo "$(RED)‚ùå –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è API$(NC)"

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ
info:
	@echo "$(BLUE)–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ:$(NC)"
	@echo "  –û–°: $(shell uname -s)"
	@echo "  –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: $(shell uname -m)"
	@echo "  –í–µ—Ä—Å–∏—è: $(shell uname -r)"
	@echo "  ADB: $(shell which adb 2>/dev/null || echo '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω')"
	@echo "  Python: $(shell python3 --version 2>/dev/null || echo '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω')"
	@echo "  Bash: $(shell bash --version | head -1 2>/dev/null || echo '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω')"
	@echo "  Make: $(shell make --version | head -1 2>/dev/null || echo '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω')"

# =============================================================================
# ANDROID –ò–ù–°–¢–†–£–ú–ï–ù–¢–´
# =============================================================================

# –ó–∞–ø—É—Å–∫ —ç–º—É–ª—è—Ç–æ—Ä–∞
emulator:
	@echo "$(BLUE)–ó–∞–ø—É—Å–∫ Android —ç–º—É–ª—è—Ç–æ—Ä–∞...$(NC)"
	@cd $(ANALYSIS_DIR) && ./scripts/bash/start_emulator.sh

# –ó–∞–ø—É—Å–∫ Android Studio
studio:
	@echo "$(BLUE)–ó–∞–ø—É—Å–∫ Android Studio –∏ —ç–º—É–ª—è—Ç–æ—Ä–∞...$(NC)"
	@cd $(ANALYSIS_DIR) && ./scripts/bash/start_android_studio.sh

# =============================================================================
# –£–ü–†–ê–í–õ–ï–ù–ò–ï –î–ê–ù–ù–´–ú–ò
# =============================================================================

# –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
clean:
	@echo "$(BLUE)–û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤...$(NC)"
	@rm -rf $(LOG_DIR)/*.log
	@rm -rf $(ANALYSIS_DIR)/temp/*
	@rm -rf $(REPORTS_DIR)/*.tmp
	@find . -name "*.pyc" -delete 2>/dev/null || true
	@find . -name "__pycache__" -type d -exec rm -rf {} + 2>/dev/null || true
	@echo "$(GREEN)‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞$(NC)"

# –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
backup:
	@echo "$(BLUE)–°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞...$(NC)"
	@tar -czf max_analyst_backup_$(shell date +%Y%m%d_%H%M%S).tar.gz \
		--exclude='*.log' \
		--exclude='temp/*' \
		--exclude='*.tmp' \
		--exclude='venv/*' \
		--exclude='.git/*' \
		$(ANALYSIS_DIR)
	@echo "$(GREEN)‚úÖ –ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω$(NC)"

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
restore:
	@echo "$(BLUE)–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞...$(NC)"
	@if [ -z "$(BACKUP_FILE)" ]; then \
		echo "$(RED)‚ùå –£–∫–∞–∂–∏—Ç–µ —Ñ–∞–π–ª –±—ç–∫–∞–ø–∞: make restore BACKUP_FILE=file.tar.gz$(NC)"; \
		exit 1; \
	fi
	@tar -xzf $(BACKUP_FILE)
	@echo "$(GREEN)‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ$(NC)"

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
update:
	@echo "$(BLUE)–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞...$(NC)"
	@git pull origin main || echo "$(YELLOW)‚ö†Ô∏è  Git –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω$(NC)"
	@echo "$(GREEN)‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ$(NC)"

# =============================================================================
# –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ö–û–ú–ê–ù–î–´
# =============================================================================

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
logs:
	@echo "$(BLUE)–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏:$(NC)"
	@tail -f $(LOG_DIR)/*.log

# –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–æ–≤
reports:
	@echo "$(BLUE)–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ—Ç—á–µ—Ç—ã:$(NC)"
	@ls -la $(REPORTS_DIR)/ 2>/dev/null || echo "$(YELLOW)–ù–µ—Ç –æ—Ç—á–µ—Ç–æ–≤$(NC)"

# –¢–µ—Å—Ç API
test-api:
	@echo "$(BLUE)–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API...$(NC)"
	@curl -s http://localhost:$(API_PORT)/api/status || echo "$(RED)‚ùå API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω$(NC)"

# =============================================================================
# –ù–ê–°–¢–†–û–ô–ö–ò
# =============================================================================

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
.DEFAULT_GOAL := help

# –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∫–æ–º–∞–Ω–¥
.IGNORE: clean stop

# –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
.SUFFIXES:
